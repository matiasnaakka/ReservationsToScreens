const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RoomList-ChDRaiMa.js","assets/vendor-CR1cO_yZ.js","assets/RoomMap-Bze01kg7.js","assets/instructions-sr0Nb6wb.js"])))=>i.map(i=>d[i]);
import{a as xe,r as t,u as ge,b as ve,j as s,c as we,B as Se}from"./vendor-CR1cO_yZ.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))h(r);new MutationObserver(r=>{for(const f of r)if(f.type==="childList")for(const a of f.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&h(a)}).observe(document,{childList:!0,subtree:!0});function d(r){const f={};return r.integrity&&(f.integrity=r.integrity),r.referrerPolicy&&(f.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?f.credentials="include":r.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function h(r){if(r.ep)return;r.ep=!0;const f=d(r);fetch(r.href,f)}})();const Re="modulepreload",be=function(i){return"/Reservationstatus/"+i},V={},D=function(u,d,h){let r=Promise.resolve();if(d&&d.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),x=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(d.map(n=>{if(n=be(n),n in V)return;V[n]=!0;const R=n.endsWith(".css"),L=R?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${L}`))return;const g=document.createElement("link");if(g.rel=R?"stylesheet":Re,R||(g.as="script"),g.crossOrigin="",g.href=n,x&&g.setAttribute("nonce",x),document.head.appendChild(g),R)return new Promise((I,E)=>{g.addEventListener("load",I),g.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${n}`)))})}))}function f(a){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=a,window.dispatchEvent(x),!x.defaultPrevented)throw a}return r.then(a=>{for(const x of a||[])x.status==="rejected"&&f(x.reason);return u().catch(f)})},ye="http://localhost:3000/",je="uXIj6PjeH9oUHC6IQ7qG",T=async(i,u,d)=>{try{return(await xe.get(`${ye}api/rooms/freespace-full`,{headers:{apikey:je},params:{floor:i,startDate:u,endDate:d}})).data.rooms}catch(h){throw console.error("Error fetching rooms:",h),h}},Le=i=>{const u=new Date;if(i.currentReservation){const d=new Date(i.currentReservation.startDate),h=new Date(i.currentReservation.endDate);if(u>=d&&u<h)return!0}if(i.nextReservation){const d=new Date(i.nextReservation.startDate),h=new Date(i.nextReservation.endDate);if(u>=d&&u<h)return!0}return!1},Ee=t.lazy(()=>D(()=>import("./RoomList-ChDRaiMa.js"),__vite__mapDeps([0,1]))),z=t.lazy(()=>D(()=>import("./RoomMap-Bze01kg7.js"),__vite__mapDeps([2,1]))),Ie=t.lazy(()=>D(()=>import("./instructions-sr0Nb6wb.js"),__vite__mapDeps([3,1]))),Ne=()=>sessionStorage.getItem("currentLoopScreen")||"roomList",ke=()=>{const[i,u]=t.useState(null),[d,h]=t.useState(Ne()),[r,f]=ge(),[a,x]=t.useState(r.get("autoScroll")==="true"),n=r.get("loopMode")==="true",R=ve(),L=t.useRef(null),g=t.useRef(null),I=!r.has("floor")||r.get("showFree")==="true",E=r.get("reservable"),B=E==="students",q=E==="staff",W=r.get("floor")||"all",Y=r.get("floorMap"),G=parseInt(r.get("loopRoomTime"))||20,X=parseInt(r.get("loopMapTime"))||10,[J,Z]=t.useState(Y||"5"),[S,Me]=t.useState(B),[b,Pe]=t.useState(q),[c,ee]=t.useState(W),[F,Te]=t.useState(E),[$,te]=t.useState([]),[se,C]=t.useState([]),[_,A]=t.useState(!1),[K,re]=t.useState(!1),[N,oe]=t.useState(!1),[m,ne]=t.useState("en"),[ae,le]=t.useState(n),[ie,ce]=t.useState(""),[ue,O]=t.useState(0),[k,De]=t.useState([]),[H,de]=t.useState([]),[y,fe]=t.useState(!1),me=["2","5","6","7"],Q=S||b?S?m==="en"?"Reservable for Students":"Varattavissa opiskelijoille":m==="en"?"Reservable for Staff":"Varattavissa henkilÃ¶kunnalle":"",v={en:{title:"Campus Rooms Available",showInstructions:"Show Instructions",hideInstructions:"Hide Instructions",floor:"Floor",loading:"Loading rooms...",noRooms:"No rooms available for the selected criteria.",closeMap:"Close Map",filterStudents:"Show Student Reservable Rooms",allRooms:"Show All Rooms",scanQRCode:"ðŸ“² Scan the room's QR code to reserve it.",nextScreen:"Coming next:",timeLeft:"",roomList:"Room List",fullMap:"Full Map",map:"Map View",scanQRCodeHeader:"Scan the room's QR code to reserve it."},fi:{title:"Kampuksen Vapaat Tilat",showInstructions:"NÃ¤ytÃ¤ ohjeet",hideInstructions:"Piilota ohjeet",floor:"Kerros",loading:"Ladataan huoneita...",noRooms:"Valitulla hakuehdolla ei ole vapaita huoneita.",closeMap:"Sulje kartta",filterStudents:"NÃ¤ytÃ¤ opiskelijoiden varattavat tilat",allRooms:"NÃ¤ytÃ¤ kaikki tilat",scanQRCode:"ðŸ“² Skannaa huoneen QR-koodi varataksesi sen.",nextScreen:"Seuraavaksi:",timeLeft:"",roomList:"Huonelista",fullMap:"Koko nÃ¤ytÃ¶n kartta",map:"KarttanÃ¤kymÃ¤",scanQRCodeHeader:"Skannaa QR-koodi varataksesi huoneen."}};t.useEffect(()=>{const e=new URLSearchParams(r);S?e.set("reservable","students"):b?e.set("reservable","staff"):e.delete("reservable"),c!=="all"?e.set("floor",c):e.delete("floor"),a?e.set("autoScroll","true"):e.delete("autoScroll");const o=`?${e.toString()}`;window.location.search!==o&&R(o,{replace:!0})},[S,b,c,a,R]);const U=async()=>{if(!_){A(!0);try{const e=new Date().toISOString().split("T")[0];let o=[];if(c!=="all")o=await T(c,`${e}T00:00`,`${e}T23:59`);else{const P=["2","5","6","7"].map(pe=>T(pe,`${e}T00:00`,`${e}T23:59`));o=(await Promise.all(P)).flat()}const w=new Date;o=o.map(l=>{if(l.nextReservation){const P=new Date(l.nextReservation.endDate);if(w>=P)return{...l,nextReservation:null}}return l});const p=["KMC590","KMD558","KMD590","KMC501","KMD616","KMD716","KMC591"],j=o.filter(l=>!Le(l)&&!p.includes(l.roomNumber)&&(!S&&!b||S&&l.reservableStudents==="true"&&(l.details==="YhteistyÃ¶tila"||l.details==="RyhmÃ¤tyÃ¶tila")||b&&l.reservableStaff==="true"&&l.details==="HenkilÃ¶stÃ¶n tyÃ¶tila"));te([...o]),C(j)}catch(e){console.error("Error fetching rooms:",e),u("Something went wrong while loading rooms. Please try again later.")}finally{A(!1)}}},M=async()=>{try{const e=new Date().toISOString().split("T")[0],w=(c!=="all"?[c]:["2","5","6","7"]).map(l=>T(l,`${e}T00:00`,`${e}T23:59`)),j=(await Promise.all(w)).flat();de(j)}catch(e){console.error("Error fetching room reservations:",e),u("Something went wrong while loading rooms. Please try again later.")}};t.useEffect(()=>{M()},[c]),t.useEffect(()=>{if(k.length===0)return;const e=k.map(o=>{const w=H.find(p=>p.roomNumber===o.roomNumber);return w?{...o,...w}:o});C(e)},[k,H]),t.useEffect(()=>{M();const e=setInterval(M,6e4);return()=>clearInterval(e)},[]),t.useEffect(()=>{const e=setInterval(()=>{ne(o=>o==="en"?"fi":"en")},2e4);return()=>clearInterval(e)},[]),t.useEffect(()=>{U();const e=setInterval(U,6e4);return()=>clearInterval(e)},[c,S,b]),t.useEffect(()=>{if(!n)return;const e=[{screen:"roomList",duration:G,next:"map"},{screen:"map",duration:X,next:"roomList"}];let o=e.findIndex(p=>p.screen===d);o===-1&&(o=0);const w=()=>{const p=e[o],j=e.find(l=>l.screen===p.next);h(p.screen),O(p.duration),ce(v[m][j.screen]),le(p.screen==="map"),o=e.findIndex(l=>l.screen===j.screen),L.current=setTimeout(w,p.duration*1e3)};return L.current=setTimeout(w,0),()=>clearTimeout(L.current)},[n,d]),t.useEffect(()=>{n&&sessionStorage.setItem("currentLoopScreen",d)},[d,n]),t.useEffect(()=>{if(n)return g.current=setInterval(()=>{O(e=>e>0?e-1:e)},1e3),()=>clearInterval(g.current)},[n]),t.useEffect(()=>{const e=r.get("autoScroll")==="true";x(e)},[r]);const he=!n&&(!K||c==="all");return t.useEffect(()=>{const e=()=>{const o=window.innerWidth>=1080&&window.innerHeight>=1980&&window.innerHeight>window.innerWidth;fe(o)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),t.useEffect(()=>{const e=r.get("floorMap");e&&Z(e)},[r]),t.useEffect(()=>{if(i){const e=setTimeout(()=>u(null),5e3);return()=>clearTimeout(e)}},[i]),s.jsxs("div",{className:"h-screen w-screen flex bg-gray-100 overflow-hidden",children:[n&&s.jsxs("div",{className:`absolute bottom-4 right-4 bg-black bg-opacity-80 text-white font-bold rounded-xl shadow-lg transition-all duration-500 ease-in-out transform z-[9999] flex items-center space-x-4
    ${y?"px-10 py-6":"px-10 py-3"}`,children:[s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:`tracking-wide opacity-80 ${y?"text-2xl":"text-xl"}`,children:v[m].nextScreen}),s.jsx("p",{className:`${y?"text-3xl":"text-2xl"} font-extrabold tracking-widest`,children:ie})]}),s.jsx("div",{className:`flex items-center justify-center bg-white text-black rounded-full font-extrabold shadow-md
      ${y?"w-24 h-24 text-5xl":"w-20 h-20 text-3xl"}`,children:ue})]}),n&&ae?s.jsx("div",{className:"absolute inset-0 flex justify-center items-center bg-white transition-opacity duration-1000",children:s.jsx("div",{className:"w-[90vw] h-[90vh] flex justify-center items-center",children:s.jsx(t.Suspense,{fallback:s.jsx("p",{className:"text-center text-gray-500",children:"Loading map..."}),children:s.jsx(z,{rooms:$,selectedFloor:n?J:c,reservableFilter:F})})})}):s.jsxs("div",{className:`relative w-full ${c==="2"?"md:w-full":"md:w-5/7"} h-full p-4 overflow-auto`,children:[s.jsxs("header",{className:"flex flex-wrap items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("h1",{className:`font-title text-metropoliaOrange font-bold drop-shadow-lg flex items-center 
  ${y?"text-6xl":"text-4xl"}`,children:[`${v[m].title} - ${c==="all"?m==="fi"?"Kaikki kerrokset":"All Floors":`${m==="fi"?"Kerros":"Floor"} ${c}`}`,Q&&s.jsx("span",{className:`ml-4 font-title text-gray-600 bg-gray-200 px-3 py-1 rounded-md shadow-sm 
      ${y?"text-2xl":"text-lg"}`,children:Q})]}),s.jsx("div",{className:"relative group",children:s.jsx("button",{className:"text-sm bg-white border px-4 py-2 rounded shadow-md opacity-0 group-hover:opacity-100 transition-opacity duration-300",onClick:()=>oe(!N),children:N?v[m].hideInstructions:v[m].showInstructions})}),s.jsx("div",{className:"relative group",children:s.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:s.jsx("select",{value:c,onChange:e=>ee(e.target.value),className:"text-sm bg-white border px-4 py-2 rounded shadow-md",children:me.map(e=>s.jsx("option",{value:e,children:`${v[m].floor} ${e}`},e))})})})]}),he&&s.jsx("h2",{className:"text-lg font-bold text-gray-700",children:v[m].scanQRCodeHeader})]}),i&&s.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded shadow text-center",children:i}),N&&s.jsx(t.Suspense,{fallback:s.jsx("p",{className:"text-center text-gray-500",children:"Loading instructions..."}),children:s.jsx(Ie,{})}),s.jsx("main",{className:"h-auto",children:_?s.jsx("p",{className:"text-center text-gray-800 font-body drop-shadow-lg",children:v[m].loading}):s.jsx(t.Suspense,{fallback:s.jsx("p",{className:"text-center text-gray-500",children:"Loading rooms..."}),children:s.jsx(Ee,{rooms:se,language:m,autoScroll:a,reservableStudents:S,reservableStaff:b,showMap:!I&&c&&!n,isLargeView:y})})})]}),!I&&c&&!n&&s.jsx("div",{className:`absolute md:static inset-0 md:w-2/7 h-full p-4 bg-gray-200 flex flex-col items-center ${K?"flex":"hidden md:flex"}`,children:s.jsxs("div",{className:"relative w-full h-full",children:[s.jsx(t.Suspense,{fallback:s.jsx("p",{className:"text-center text-gray-500",children:"Loading map..."}),children:s.jsx(z,{rooms:$,selectedFloor:c,reservableFilter:F})}),s.jsx("button",{className:"absolute top-4 right-4 bg-red-500 text-white px-4 py-2 rounded shadow-lg md:hidden",onClick:()=>re(!1),children:v[m].closeMap})]})})]})};we.createRoot(document.getElementById("root")).render(s.jsx(t.StrictMode,{children:s.jsx(Se,{children:s.jsx(ke,{})})}));export{Le as i};
